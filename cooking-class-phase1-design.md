# 料理教室告知システム Phase 1 設計書

## 概要

レッスン情報を入力すると、AIが以下を自動生成するシステム：
- LP用HTML（静的ファイル）
- LINE告知文（テキスト）
- メール告知文（テキスト）

---

## 技術構成（GCP統一）

```
┌─────────────────────────────────────────┐
│  管理画面（Next.js / Cloud Run）          │
├─────────────────────────────────────────┤
│                                          │
│  [生成する] → Vertex AI (Gemini)         │
│               ├── HTML                   │
│               ├── LINE文                 │
│               └── メール文               │
│                                          │
│  [LP公開] → Cloud Storage                │
│             → Cloud Functions            │
│             → Firebase Hosting           │
│                                          │
│  [LINE送信] → LINE Messaging API         │
│                                          │
│  [メール送信] → Gmail API                │
│                                          │
├─────────────────────────────────────────┤
│  Firestore                               │
│  ├── students/（生徒一覧）               │
│  └── lessons/（レッスン情報）             │
└─────────────────────────────────────────┘
```

---

## 入力フォーム設計

### 毎回入力する項目

| 項目 | 型 | 例 |
|------|-----|-----|
| お品書き | textarea | 🍴お品書き🍴\n🥔 1. ほっくり重ね煮の旨み... |
| 日時 | datetime | 2026-01-31 10:00 |
| 時間（分） | number | 120 |
| 料金（税込） | number | 2090 |
| 講師名 | text | 山田花子 |
| レゼルバURL | text | https://reserva.be/xxx/reserve?... |

### 固定項目（コード内定数）

**教室情報**
```
教室名: （要確認）
LINE友だち追加URL: （要確認）
LINE QRコード画像: （要確認）← フッター用
```

**予約注意事項・キャンセルポリシー**
```
予約に関する注意事項
予約締切：1日前の22:00まで

キャンセルポリシー
当日：代金の100％
7日前まで：代金の100％

■ キャンセル・変更について
・開催日の 8日前まで のキャンセル・変更は、無料 にて承ります。
・開催日の7日前以降のキャンセル・変更はお受けできません。
　（レシピやアーカイブ動画をお届けいたします。受講料のご返金はいたしかねますので、あらかじめご了承ください。）

■ 開催中止について
講師の都合、システム不具合、天災その他やむを得ない事情により講座の開催を中止する場合は、速やかにご連絡のうえ、全額返金または振替受講にて対応いたします。
```

---

## トーン＆マナー

### 基本トーン

- **雰囲気**: 温かい、親しみやすい、ポジティブ、安心感がある
- **立場**: 完璧を求める「厳しい先生」ではなく、一緒に頑張る「共感者・サポーター」
- **文体**: です・ます調。適度に「！」「🍳」「✨」などの絵文字や記号を使い、親しみやすさを出す

### 執筆ガイドライン

- **共感から入る**: 「忙しいですよね」「毎日お疲れ様です」といった、ユーザーの日常の苦労（献立の悩み、時間のなさ）に寄り添う表現を必ず入れる
- **ハードルを下げる**: 「画面オフOK」「見るだけOK」「材料変更自由」など、参加の心理的ハードルを下げるキーワードを意識する
- **ベネフィットの提示**: 単に「料理を作る」だけでなく、その先の「心のゆとり」「家族との時間」「栄養への安心感」を強調する
- **視覚的な読みやすさ**: 箇条書き（「✳︎」や「✔︎」を使用）を活用し、スマホで流し読みしても内容が伝わる構成にする

### 禁止事項

- 「〜すべき」「〜しなければならない」といった強制的・威圧的な表現
- 難解な専門用語や、堅苦しすぎるビジネス敬語
- 「時短」だけを強調し、「愛情や健康」を軽視するような表現

---

## デザイン・トンマナ（ビジュアル・UI/UX）

### 視覚的コンセプト

**テーマ**: 「明るいキッチン」「自然体」「日常の豊かさ」

**カラーパレット**

| 用途 | カラー | 意図 |
|------|--------|------|
| メイン | コーラルピンク系 | 温かみ、愛情、楽しさ |
| ベース | ホワイト〜オフホワイト | 清潔感、余白の広がり |
| アクセント | グリーン・イエロー | 新鮮な野菜、活気 |
| テキスト | 濃いグレー | 読みやすさ重視（真っ黒は避ける） |

### デザイン原則

**写真の選定**
- 自然光が入る明るい写真
- 「完璧なプロの料理」よりも「生き生きとした調理シーン」や「温かい食卓」を優先
- 人物（特に笑顔）が写っているものを選び、親近感を出す

**余白とレイアウト**
- 情報を詰め込みすぎず、ゆったりとした余白を設ける
- セクションごとに水平線や淡い背景色の切り替えを使い、視覚的に情報を区切る

**アイコン・装飾**
- 「🍳」「🥗」「✨」「💡」などの親しみやすい絵文字をアクセントとして使用
- 角の丸い（Round corner）ボタンや枠線を使用し、柔らかい印象を与える

**タイポグラフィ**
- 見出しは大きく、視認性を高く
- 重要なフレーズは太字（ボールド）にし、一目でメリットが伝わるようにする

### 具体的な構成要素

**ボタン**
- 柔らかい曲線を持たせ、クリックしたくなる安心感を出す
- 角丸（border-radius）を十分に取る

**カード**
- 枠線は細く、またはドロップシャドウを薄くかけ、背景から浮かび上がるような清潔なデザイン

---

## 管理画面UI

```
┌─────────────────────────────────────────┐
│ レッスン告知作成                          │
├─────────────────────────────────────────┤
│                                          │
│ 【毎回入力】                              │
│                                          │
│ お品書き                                  │
│ ┌────────────────────────────────────┐  │
│ │ 🍴お品書き🍴                        │  │
│ │ 🥔 1. ほっくり重ね煮の旨み...       │  │
│ │ 🐟 2. ふっくらサワラのごま煮...     │  │
│ │ ...                                │  │
│ └────────────────────────────────────┘  │
│                                          │
│ 日時      [2026-01-31]  [10:00]         │
│ 時間（分） [120]                         │
│ 料金      [2090]                         │
│ 講師名    [山田花子        ]             │
│ レゼルバURL [https://reserva.be/...   ]  │
│                                          │
│ [生成する]                               │
├─────────────────────────────────────────┤
│                                          │
│ 【HTML】                                 │
│ ┌────────────────────────────────────┐  │
│ │ <プレビュー表示>                    │  │
│ └────────────────────────────────────┘  │
│ [公開する] → Firebase Hosting            │
│ ✅ 公開済: https://xxx.web.app/lesson-xxx │
│                                          │
│ 【LINE】                                 │
│ ┌────────────────────────────────────┐  │
│ │ 🌸新しいレッスンのご案内🌸          │  │
│ │ 1/31(土) 10:00〜...                │  │
│ └────────────────────────────────────┘  │
│ [コピー] [送信する]                      │
│                                          │
│ 【メール】                               │
│ ┌────────────────────────────────────┐  │
│ │ 件名: 1月のレッスンのご案内         │  │
│ │ 本文: ...                          │  │
│ └────────────────────────────────────┘  │
│ [コピー] [送信する]                      │
│                                          │
└─────────────────────────────────────────┘
```

---

## LP構成要素

```
┌─────────────────────────────────────────┐
│ ヘッダー（教室名・ロゴ）                  │
├─────────────────────────────────────────┤
│ メインビジュアル（画像）                  │
├─────────────────────────────────────────┤
│ レッスン情報                             │
│  - 日時・時間・料金                       │
│  - 講師名                                │
│  - お品書き（AI生成で整形）               │
├─────────────────────────────────────────┤
│ [ 予約する ] ← レゼルバURL               │
├─────────────────────────────────────────┤
│ 予約に関する注意事項（固定）              │
│ キャンセルポリシー（固定）                │
├─────────────────────────────────────────┤
│ フッター                                 │
│  - LINE友だち追加QRコード                │
│  - 教室情報                              │
└─────────────────────────────────────────┘
```

---

## LP公開フロー

```
[公開する]ボタン押下
    ↓
Cloud Storage にHTMLアップロード
    ↓
Cloud Functions がトリガー
    ↓
Firebase Hosting にデプロイ
    ↓
公開URL発行: https://xxx.web.app/lessons/2026-01-31
```

---

## Firestoreスキーマ

### students/（生徒一覧）

```
students/
└── {studentId}
    ├── name: "山田花子"
    ├── email: "hanako@example.com"
    ├── lineUserId: "U1234..."  ← LINE連携済みなら
    ├── createdAt: timestamp
    └── tags: ["常連", "和食好き"]  ← 将来のセグメント配信用
```

### lessons/（レッスン情報）

```
lessons/
└── {lessonId}
    ├── menu: "🍴お品書き🍴\n🥔 1. ほっくり..."
    ├── datetime: 2026-01-31T10:00
    ├── duration: 120
    ├── price: 2090
    ├── htmlUrl: "https://xxx.web.app/lessons/2026-01-31"
    ├── lineText: "🌸新しいレッスン..."
    ├── emailSubject: "1月のレッスンのご案内"
    ├── emailBody: "..."
    ├── createdAt: timestamp
    └── publishedAt: timestamp
```

---

## LINE/メール送信

### LINE（Messaging API）

- 生徒40人以内 → 無料枠で十分
- 友だち全員に一斉配信

### メール（Gmail API）

- 生徒40人以内 → 500通/日制限で十分
- GCP純度100%

---

## 開発ステップ

| Step | 内容 | 成果物 |
|------|------|--------|
| 1a | 管理画面UI + AI生成 | 入力 → HTML/LINE/メール表示 |
| 1b | LP自動公開 | Cloud Storage → Hosting連携 |
| 1c | 生徒DB + 送信機能 | Firestore + LINE/Gmail API |

---

## Phase 2以降の構想

### LINEアンケート → パーソナライズ配信

```
友だち追加
    ↓
自動でアンケート依頼メッセージ送信
    ↓
リッチメニュー or ボタンタップ
    ↓
LIFF（LINE内Webフォーム）表示
    ↓
回答 → Firestore に保存
    ↓
以降の配信はパーソナライズ
```

### アンケート項目（案）

| 項目 | 選択肢例 |
|------|----------|
| 家族構成 | 一人暮らし / 夫婦のみ / 子供あり（未就学）/ 子供あり（小学生以上） |
| 好きなジャンル | 和食 / 洋食 / 中華 / エスニック / お菓子 |
| 重視すること | 時短 / 栄養バランス / 見栄え / 作り置き |
| 食事制限 | なし / アレルギーあり / ベジタリアン等 |

### パーソナライズのパターン

**挨拶の出し分け**

| 条件 | 挨拶 |
|------|------|
| visitCount >= 3 | 「{name}さん、いつもありがとうございます🍳」 |
| lastVisit が3ヶ月以上前 | 「{name}さん、お久しぶりです✨ また一緒にお料理できたら嬉しいです！」 |
| 初回 | 「{name}さん、はじめまして！」 |

**レッスン訴求の出し分け**

| 条件 | 訴求ポイント |
|------|--------------|
| favoriteGenre に「時短」 | 「今回も時短テク満載です💯」 |
| familyType が「子供あり」 | 「お子さんも喜ぶメニューですよ🎵」 |
| favoriteGenre に「和食」 | 「出汁の基本から丁寧にお伝えします」 |

### 実装方式

| Phase | 方式 | 内容 |
|-------|------|------|
| Phase 2a | テンプレ + 差し込み | 挨拶・訴求を条件分岐で差し替え |
| Phase 2b | セグメント別AI生成 | 5〜10パターンをAI生成 → 振り分け |
| Phase 3 | 全員個別AI生成 | 40人 × 個別メッセージ生成 |

### Firestoreスキーマ（拡張版）

```
students/
└── {lineUserId}
    ├── name: "山田花子"
    ├── email: "hanako@example.com"
    ├── lineUserId: "U1234..."
    │
    │  # アンケート回答
    ├── profile:
    │   ├── familyType: "夫婦+子供2人"
    │   ├── childAge: "小学生"
    │   ├── favoriteGenre: ["和食", "時短"]
    │   └── dietaryRestrictions: ["なし"]
    │
    │  # 行動データ（自動更新）
    ├── stats:
    │   ├── visitCount: 5
    │   ├── lastVisit: 2025-12-01
    │   └── totalSpent: 27500
    │
    └── createdAt: timestamp
```

### 技術構成（Phase 2追加分）

```
LINE友だち追加
    ↓ Webhook
Cloud Functions（友だち追加イベント）
    ↓
アンケート依頼メッセージ送信
    ↓
LIFF（Next.js or 単体HTML）
    ↓
Firestore に保存

配信時:
管理画面 [送信する]
    ↓
Cloud Functions
    ├── Firestore から生徒一覧取得
    ├── 各生徒のprofile/statsを参照
    ├── パーソナライズ文章生成（or テンプレ差し込み）
    └── LINE Messaging API で送信
```

---

## 決定事項

| 項目 | 決定 |
|------|------|
| 予約ボタンのリンク先 | レゼルバURL（毎回入力） |
| LP内LINE友だち追加 | あり（固定URL） |
| 講師名 | 毎回入力（テキスト） |
| トンマナ | 温かい・親しみやすい・共感者スタイル |

## 未決定事項

| 項目 | 備考 |
|------|------|
| 教室名 | 表記を確認 |
| LINE友だち追加URL | 固定値を確認 |
| LINE QRコード画像 | フッター用画像ファイル |
